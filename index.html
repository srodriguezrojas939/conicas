<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cónicas PRO - √(Raiz) Cuadrada²</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Open+Sans:wght@400;600;700&display=swap');

        body { 
            background: white; font-family: 'Open Sans', sans-serif; 
            display: flex; justify-content: center; padding: 20px; color: #333; margin: 0;
        }

        .calculadora-moderna {
            max-width: 1000px; width: 100%; padding: 40px;
            background: #F2F2F2; border-radius: 40px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.05);
        }

        .header-section { text-align: center; margin-bottom: 25px; }
        .header-section h1 { font-size: 26px; margin: 0; font-family: 'Playfair Display', serif; }
        .header-section p { font-size: 18px; font-weight: 600; font-family: 'Playfair Display', serif; margin: 5px 0; }

        .pill-container { display: flex; justify-content: center; margin-bottom: 30px; }
        .pill { background: #e0e0e0; border-radius: 50px; padding: 5px; display: flex; border: 1px solid #ccc; flex-wrap: wrap; justify-content: center; }
        .pill-btn { 
            border: none; padding: 10px 20px; border-radius: 40px; font-size: 12px; 
            font-weight: 700; cursor: pointer; transition: 0.3s; background: transparent; color: #666; 
        }
        .pill-btn.active { background: white; color: black; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }

        .main-grid { display: grid; grid-template-columns: 380px 1fr; gap: 30px; margin-bottom: 20px; }
        @media (max-width: 900px) { .main-grid { grid-template-columns: 1fr; } }

        .control-panel { 
            background: white; border-radius: 25px; padding: 30px; border: 1px solid #ddd;
            display: flex; flex-direction: column; align-items: center; text-align: center;
        }
        
        #inputs-area { width: 100%; display: flex; flex-direction: column; align-items: center; gap: 15px; }
        .control-group { width: 100%; }
        .control-group label { display: block; font-size: 10px; font-weight: 700; color: #999; text-transform: uppercase; margin-bottom: 8px; letter-spacing: 1px; }
        
        .inputs-row { display: flex; gap: 10px; justify-content: center; width: 100%; }
        input[type="number"], select { 
            padding: 12px; border: 1px solid #ddd; border-radius: 15px; 
            font-family: 'Open Sans'; font-size: 14px; width: 90px; text-align: center; background: #fafafa;
        }

        .formula-box { 
            width: 100%; background: #f9f9f9; padding: 15px; border-radius: 20px; 
            margin-top: 15px; border: 1px solid #eee; box-sizing: border-box;
        }
        .formula-box b { 
            color: #555; font-size: 11px; display: block; text-transform: uppercase; 
            margin-bottom: 8px; font-family: 'Open Sans', sans-serif; font-weight: 700;
        }
        .formula-text { font-family: 'Open Sans', sans-serif; font-size: 14px; color: #000; font-weight: 600; word-break: break-all; }

        .data-badge-grid { 
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; width: 100%; margin-top: 15px; 
        }
        .data-badge { 
            background: #f0f0f0; padding: 10px; border-radius: 15px; font-size: 11px; 
            font-family: 'Open Sans'; font-weight: 700; color: #666;
        }
        .data-badge span { color: #000; display: block; font-size: 13px; }

        #graph-container { background: white; border-radius: 25px; border: 1px solid #ddd; height: 550px; position: relative; overflow: hidden; }
        .watermark { position: absolute; bottom: 15px; right: 20px; font-family: 'Playfair Display', serif; font-weight: bold; font-size: 12px; color: #bbb; pointer-events: none; z-index: 10; }

        .btn-black { 
            background: black; color: white; border: none; padding: 12px 25px; 
            border-radius: 30px; font-weight: 700; cursor: pointer; transition: 0.3s;
            display: flex; align-items: center; justify-content: center; gap: 8px; margin: 15px auto 0;
        }
        .btn-download { background: white; color: black; border: 1px solid #ccc; }
    </style>
</head>
<body>

<div class="calculadora-moderna">
    <div class="header-section">
        <h1>Calculadora de Cónicas</h1>
        <p>√(Raiz) Cuadrada²</p>
    </div>

    <div class="pill-container">
        <div class="pill">
            <button class="pill-btn active" onclick="changeConic('circle', this)">Circunferencia</button>
            <button class="pill-btn" onclick="changeConic('ellipse', this)">Elipse</button>
            <button class="pill-btn" onclick="changeConic('parabola', this)">Parábola</button>
            <button class="pill-btn" onclick="changeConic('hyperbola', this)">Hipérbola</button>
        </div>
    </div>

    <div class="main-grid">
        <div class="control-panel">
            <div id="inputs-area"></div>

            <div class="formula-box">
                <b>Ecuación Canónica</b>
                <div id="eq-canonical" class="formula-text">...</div>
            </div>
            <div class="formula-box">
                <b>Ecuación General</b>
                <div id="eq-general" class="formula-text">...</div>
            </div>

            <div class="data-badge-grid" id="data-panel"></div>
        </div>

        <div id="graph-container">
            <div id="plot" style="width:100%; height:100%;"></div>
            <div class="watermark">√(Raiz) Cuadrada²</div>
        </div>
    </div>

    <button class="btn-black btn-download" onclick="downloadPNG()">
        <img src="https://cdn-icons-png.flaticon.com/512/724/724933.png" width="16" alt="icon">
        Descargar en PNG
    </button>
</div>

<canvas id="export-canvas" style="display:none;"></canvas>

<script>
    let currentConic = 'circle';
    const params = { h: 0, k: 0, r: 5, a: 5, b: 3, orient: 'h', p: 2, porient: 'v' };

    function changeConic(type, btn) {
        currentConic = type;
        document.querySelectorAll('.pill-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        renderInputs();
        updateAll();
    }

    function renderInputs() {
        const area = document.getElementById('inputs-area');
        let html = '';
        if (currentConic === 'circle') {
            html = `<div class="control-group"><label>Centro (h, k)</label><div class="inputs-row">
                <input type="number" value="${params.h}" oninput="params.h=parseFloat(this.value)||0;updateAll()">
                <input type="number" value="${params.k}" oninput="params.k=parseFloat(this.value)||0;updateAll()">
            </div></div><div class="control-group"><label>Radio (r)</label>
            <input type="number" value="${params.r}" oninput="params.r=parseFloat(this.value)||1;updateAll()"></div>`;
        } else if (currentConic === 'ellipse' || currentConic === 'hyperbola') {
            html = `<div class="control-group"><label>Centro (h, k)</label><div class="inputs-row">
                <input type="number" value="${params.h}" oninput="params.h=parseFloat(this.value)||0;updateAll()">
                <input type="number" value="${params.k}" oninput="params.k=parseFloat(this.value)||0;updateAll()">
            </div></div><div class="control-group"><label>Parámetros (a, b)</label><div class="inputs-row">
                <input type="number" value="${params.a}" oninput="params.a=parseFloat(this.value)||1;updateAll()">
                <input type="number" value="${params.b}" oninput="params.b=parseFloat(this.value)||1;updateAll()">
            </div></div><div class="control-group"><label>Orientación</label>
            <select onchange="params.orient=this.value;updateAll()"><option value="h">Horizontal</option><option value="v">Vertical</option></select></div>`;
        } else if (currentConic === 'parabola') {
            html = `<div class="control-group"><label>Vértice (h, k)</label><div class="inputs-row">
                <input type="number" value="${params.h}" oninput="params.h=parseFloat(this.value)||0;updateAll()">
                <input type="number" value="${params.k}" oninput="params.k=parseFloat(this.value)||0;updateAll()">
            </div></div><div class="control-group"><label>Parámetro (p)</label>
            <input type="number" value="${params.p}" oninput="params.p=parseFloat(this.value)||1;updateAll()"></div><div class="control-group">
            <label>Abre hacia</label><select onchange="params.porient=this.value;updateAll()"><option value="v">Vertical (Y)</option><option value="h">Horizontal (X)</option></select></div>`;
        }
        area.innerHTML = html;
    }

    function updateAll() {
        const {h, k, r, a, b, orient, p, porient} = params;
        let canonical = '', general = '', traces = [], info = '';

        if (currentConic === 'circle') {
            canonical = `(x - ${h})² + (y - ${k})² = ${r*r}`;
            general = `x² + y² ${fmt(-2*h)}x ${fmt(-2*k)}y ${fmt(h*h + k*k - r*r)} = 0`;
            info = `<div class="data-badge">Radio<span>${r}</span></div><div class="data-badge">Excentricidad<span>0</span></div>`;
            let t = Array.from({length: 100}, (_, i) => i * 2 * Math.PI / 99);
            traces.push({ x: t.map(v => h + r*Math.cos(v)), y: t.map(v => k + r*Math.sin(v)), name: 'Círculo', line: {color: 'black', width: 3} });
        } 
        else if (currentConic === 'ellipse') {
            let c = Math.sqrt(Math.abs(a*a - b*b));
            let e = (a >= b) ? c/a : c/b;
            if(orient === 'h') {
                canonical = `(x-${h})²/${a*a} + (y-${k})²/${b*b} = 1`;
                general = `${b*b}x² + ${a*a}y² ${fmt(-2*h*b*b)}x ${fmt(-2*k*a*a)}y ${fmt(h*h*b*b + k*k*a*a - a*a*b*b)} = 0`;
            } else {
                canonical = `(x-${h})²/${b*b} + (y-${k})²/${a*a} = 1`;
                general = `${a*a}x² + ${b*b}y² ${fmt(-2*h*a*a)}x ${fmt(-2*k*b*b)}y ${fmt(h*h*a*a + k*k*b*b - a*a*b*b)} = 0`;
            }
            info = `<div class="data-badge">c (Focal)<span>${c.toFixed(2)}</span></div><div class="data-badge">e<span>${e.toFixed(2)}</span></div>`;
            let t = Array.from({length: 100}, (_, i) => i * 2 * Math.PI / 99);
            traces.push({ x: t.map(v => h + (orient==='h'?a:b)*Math.cos(v)), y: t.map(v => k + (orient==='h'?b:a)*Math.sin(v)), line: {color: 'black', width: 3} });
        } 
        else if (currentConic === 'parabola') {
            if(porient === 'v') {
                canonical = `(x - ${h})² = ${4*p}(y - ${k})`;
                general = `x² ${fmt(-2*h)}x ${fmt(-4*p)}y ${fmt(h*h + 4*p*k)} = 0`;
            } else {
                canonical = `(y - ${k})² = ${4*p}(x - ${h})`;
                general = `y² ${fmt(-2*k)}y ${fmt(-4*p)}x ${fmt(k*k + 4*p*h)} = 0`;
            }
            info = `<div class="data-badge">Foco<span>${porient==='v'?(k+p).toFixed(1):(h+p).toFixed(1)}</span></div><div class="data-badge">e<span>1.00</span></div>`;
            let t = Array.from({length: 100}, (_, i) => -10 + i*0.2);
            let px = porient==='v' ? t.map(x => x+h) : t.map(y => (Math.pow(y, 2)/(4*p)) + h);
            let py = porient==='v' ? t.map(x => (Math.pow(x, 2)/(4*p)) + k) : t.map(y => y+k);
            traces.push({ x: px, y: py, line: {color: 'black', width: 3} });
        } 
        else if (currentConic === 'hyperbola') {
            let c = Math.sqrt(a*a + b*b);
            let e = c/a;
            if(orient === 'h') {
                canonical = `(x-${h})²/${a*a} - (y-${k})²/${b*b} = 1`;
                general = `${b*b}x² - ${a*a}y² ${fmt(-2*h*b*b)}x ${fmt(2*k*a*a)}y ${fmt(h*h*b*b - k*k*a*a - a*a*b*b)} = 0`;
                info = `<div class="data-badge">e<span>${e.toFixed(2)}</span></div><div class="data-badge">Asín.<span>y-k=±${(b/a).toFixed(2)}(x-h)</span></div>`;
                // Asíntotas
                traces.push({ x: [h-15, h+15], y: [k - (b/a)*15, k + (b/a)*15], line: {dash: 'dash', color: '#ccc', width: 1} });
                traces.push({ x: [h-15, h+15], y: [k + (b/a)*15, k - (b/a)*15], line: {dash: 'dash', color: '#ccc', width: 1} });
            } else {
                canonical = `(y-${k})²/${a*a} - (x-${h})²/${b*b} = 1`;
                general = `${-a*a}x² + ${b*b}y² ${fmt(2*h*a*a)}x ${fmt(-2*k*b*b)}y ${fmt(-h*h*a*a + k*k*b*b - a*a*b*b)} = 0`;
                info = `<div class="data-badge">e<span>${e.toFixed(2)}</span></div><div class="data-badge">Asín.<span>y-k=±${(a/b).toFixed(2)}(x-h)</span></div>`;
                traces.push({ x: [h - (b/a)*15, h + (b/a)*15], y: [k-15, k+15], line: {dash: 'dash', color: '#ccc', width: 1} });
                traces.push({ x: [h + (b/a)*15, h - (b/a)*15], y: [k-15, k+15], line: {dash: 'dash', color: '#ccc', width: 1} });
            }
            let t = Array.from({length: 100}, (_, i) => -3 + i*0.06);
            if(orient === 'h'){
                traces.push({ x: t.map(v => h + a*Math.cosh(v)), y: t.map(v => k + b*Math.sinh(v)), line: {color: 'black', width:3} });
                traces.push({ x: t.map(v => h - a*Math.cosh(v)), y: t.map(v => k + b*Math.sinh(v)), line: {color: 'black', width:3} });
            } else {
                traces.push({ y: t.map(v => k + a*Math.cosh(v)), x: t.map(v => h + b*Math.sinh(v)), line: {color: 'black', width:3} });
                traces.push({ y: t.map(v => k - a*Math.cosh(v)), x: t.map(v => h + b*Math.sinh(v)), line: {color: 'black', width:3} });
            }
        }

        document.getElementById('eq-canonical').innerText = canonical;
        document.getElementById('eq-general').innerText = general;
        document.getElementById('data-panel').innerHTML = info;

        Plotly.newPlot('plot', traces, {
            xaxis: { range: [h-15, h+15], zeroline: true, gridcolor: '#eee' },
            yaxis: { range: [k-15, k+15], zeroline: true, gridcolor: '#eee', scaleanchor: "x" },
            margin: { l: 20, r: 20, t: 20, b: 20 }, showlegend: false
        }, {responsive: true, displayModeBar: false});
    }

    function fmt(num) {
        if (num === 0) return "";
        return num > 0 ? "+ " + num.toFixed(1) : "- " + Math.abs(num).toFixed(1);
    }

    async function downloadPNG() {
        const gd = document.getElementById('plot');
        const imgData = await Plotly.toImage(gd, { format: 'png', width: 1000, height: 800 });
        const canvas = document.getElementById('export-canvas');
        const ctx = canvas.getContext('2d');
        const img = new Image();
        img.onload = function() {
            canvas.width = 1000; canvas.height = 800;
            ctx.fillStyle = "white"; ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(img, 0, 0);
            ctx.font = "bold 24px 'Playfair Display'";
            ctx.fillStyle = "rgba(100, 100, 100, 0.6)";
            ctx.textAlign = "right";
            ctx.fillText("√(Raiz) Cuadrada²", canvas.width - 40, canvas.height - 40);
            const link = document.createElement('a');
            link.download = `Conica-${currentConic}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
        };
        img.src = imgData;
    }

    renderInputs();
    updateAll();
</script>
</body>
</html>
